#!/usr/bin/env bash
# Install necessary tools
sudo apt update
sudo apt install net-tools curl lsof -y

# Check current Nginx status
sudo service nginx status

# Start Nginx if not running
if sudo service nginx status | grep -q "active (running)"; then
    echo "Nginx is already running."
else
    sudo service nginx start
fi

# Check process using port 8080
sudo netstat -tuln | grep 8080

# Find the process ID using port 8080
process_id=$(sudo lsof -t -i :8080)

# Stop the process using port 8080
if [ -n "$process_id" ]; then
    sudo kill "$process_id"
fi

# Check Apache status
if sudo service apache2 status | grep -q "is running"; then
    echo "Apache is running. Stopping Apache..."
    sudo service apache2 stop
else
    echo "Apache is not running."
fi

# Configure Nginx
sudo sed -i 's/listen 80 default_server;/listen 80;/g' /etc/nginx/sites-available/default

# Restart Nginx
sudo service nginx restart

# Verify Nginx status
if sudo service nginx status | grep -q "active (running)"; then
    echo "Nginx is running and listening on port 80."
else
    echo "Failed to start Nginx."
fi

# Check if Apache is running again
if sudo service apache2 status | grep -q "is running"; then
    echo "Apache is still running."
else
    echo "Apache is not running."
fi

sudo netstat -tuln | grep 80
